<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>autofaiss.external package &mdash; autofaiss 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="autofaiss.indices package" href="autofaiss.indices.html" />
    <link rel="prev" title="autofaiss package" href="autofaiss.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> autofaiss
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction and installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html#installing-the-requirements">Installing the requirements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started with the CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quantization.html">Creating an index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quantization.html#tuning-an-existing-index">Tuning an existing index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quantization.html#getting-scores-on-an-index">Getting scores on an index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use autofaiss from python</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../API/api.html">Python documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">autofaiss</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="autofaiss.html">autofaiss package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="autofaiss.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">autofaiss.external package</a></li>
<li class="toctree-l4"><a class="reference internal" href="autofaiss.indices.html">autofaiss.indices package</a></li>
<li class="toctree-l4"><a class="reference internal" href="autofaiss.metrics.html">autofaiss.metrics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="autofaiss.utils.html">autofaiss.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="autofaiss.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofaiss.html#module-autofaiss.version">autofaiss.version module</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofaiss.html#module-autofaiss">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started with notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/autofaiss_getting_started.html">Autofaiss getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/autofaiss_index_selection_demo.html">Autofaiss Index selection demo slider</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">autofaiss</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="modules.html">autofaiss</a> &raquo;</li>
          <li><a href="autofaiss.html">autofaiss package</a> &raquo;</li>
      <li>autofaiss.external package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_source/autofaiss.external.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="autofaiss-external-package">
<h1>autofaiss.external package<a class="headerlink" href="#autofaiss-external-package" title="Permalink to this headline"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline"></a></h2>
</section>
<section id="module-autofaiss.external.build">
<span id="autofaiss-external-build-module"></span><h2>autofaiss.external.build module<a class="headerlink" href="#module-autofaiss.external.build" title="Permalink to this headline"></a></h2>
<p>gather functions necessary to build an index</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.build.create_index">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.build.</span></span><span class="sig-name descname"><span class="pre">create_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_memory_available</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_ids_df_handler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_direct_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distributed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temporary_indices_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hdfs://root/tmp/distributed_autofaiss_indices'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_indices_to_keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/build.html#create_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.build.create_index" title="Permalink to this definition"></a></dt>
<dd><p>Function that returns an index on the numpy arrays stored on disk in the embeddings_path path.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.build.estimate_memory_required_for_index_creation">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.build.</span></span><span class="sig-name descname"><span class="pre">estimate_memory_required_for_index_creation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vec_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_index_memory_usage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_direct_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_indices_to_keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/build.html#estimate_memory_required_for_index_creation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.build.estimate_memory_required_for_index_creation" title="Permalink to this definition"></a></dt>
<dd><p>Estimates the RAM necessary to create the index
The value returned is in Bytes</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.build.get_estimated_construction_time_infos">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.build.</span></span><span class="sig-name descname"><span class="pre">get_estimated_construction_time_infos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vec_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/build.html#get_estimated_construction_time_infos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.build.get_estimated_construction_time_infos" title="Permalink to this definition"></a></dt>
<dd><p>Gives a general approximation of the construction time of the index</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-autofaiss.external.descriptions">
<span id="autofaiss-external-descriptions-module"></span><h2>autofaiss.external.descriptions module<a class="headerlink" href="#module-autofaiss.external.descriptions" title="Permalink to this headline"></a></h2>
<p>File that contains the descriptions of the different indices features.</p>
<dl class="py class">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">autofaiss.external.descriptions.</span></span><span class="sig-name descname"><span class="pre">IndexBlock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/descriptions.html#IndexBlock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a></p>
<p>An enumeration.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock.FLAT">
<span class="sig-name descname"><span class="pre">FLAT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock.FLAT" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock.HNSW">
<span class="sig-name descname"><span class="pre">HNSW</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock.HNSW" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock.IVF">
<span class="sig-name descname"><span class="pre">IVF</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock.IVF" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock.IVF_HNSW">
<span class="sig-name descname"><span class="pre">IVF_HNSW</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock.IVF_HNSW" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock.OPQ">
<span class="sig-name descname"><span class="pre">OPQ</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">5</span></em><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock.OPQ" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock.PAD">
<span class="sig-name descname"><span class="pre">PAD</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">6</span></em><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock.PAD" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.IndexBlock.PQ">
<span class="sig-name descname"><span class="pre">PQ</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4</span></em><a class="headerlink" href="#autofaiss.external.descriptions.IndexBlock.PQ" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.TunableParam">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">autofaiss.external.descriptions.</span></span><span class="sig-name descname"><span class="pre">TunableParam</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/descriptions.html#TunableParam"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.descriptions.TunableParam" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a></p>
<p>An enumeration.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.TunableParam.EFSEARCH">
<span class="sig-name descname"><span class="pre">EFSEARCH</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#autofaiss.external.descriptions.TunableParam.EFSEARCH" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.TunableParam.HT">
<span class="sig-name descname"><span class="pre">HT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#autofaiss.external.descriptions.TunableParam.HT" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.descriptions.TunableParam.NPROBE">
<span class="sig-name descname"><span class="pre">NPROBE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#autofaiss.external.descriptions.TunableParam.NPROBE" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-autofaiss.external.metadata">
<span id="autofaiss-external-metadata-module"></span><h2>autofaiss.external.metadata module<a class="headerlink" href="#module-autofaiss.external.metadata" title="Permalink to this headline"></a></h2>
<p>Index metadata for Faiss indices.</p>
<dl class="py class">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">autofaiss.external.metadata.</span></span><span class="sig-name descname"><span class="pre">IndexMetadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_direct_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Class to compute index metadata given the index_key, the number of vectors and their dimension.</p>
<p>Note: We don’t create classes for each index type in order to keep the code simple.</p>
<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_ivf_flat">
<span class="sig-name descname"><span class="pre">compute_memory_necessary_for_ivf_flat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_training_vectors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.compute_memory_necessary_for_ivf_flat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_ivf_flat" title="Permalink to this definition"></a></dt>
<dd><p>Compute the memory estimation for index type IVF_FLAT.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_opq_ivf_hnsw_pq">
<span class="sig-name descname"><span class="pre">compute_memory_necessary_for_opq_ivf_hnsw_pq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_training_vectors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.compute_memory_necessary_for_opq_ivf_hnsw_pq"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_opq_ivf_hnsw_pq" title="Permalink to this definition"></a></dt>
<dd><p>Compute the memory estimation for index type OPQ_IVF_HNSW_PQ.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_opq_ivf_pq">
<span class="sig-name descname"><span class="pre">compute_memory_necessary_for_opq_ivf_pq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_training_vectors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.compute_memory_necessary_for_opq_ivf_pq"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_opq_ivf_pq" title="Permalink to this definition"></a></dt>
<dd><p>Compute the memory estimation for index type OPQ_IVF_PQ.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_pad_ivf_hnsw_pq">
<span class="sig-name descname"><span class="pre">compute_memory_necessary_for_pad_ivf_hnsw_pq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_training_vectors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.compute_memory_necessary_for_pad_ivf_hnsw_pq"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_pad_ivf_hnsw_pq" title="Permalink to this definition"></a></dt>
<dd><p>Compute the memory estimation for index type PAD_IVF_HNSW_PQ.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_training">
<span class="sig-name descname"><span class="pre">compute_memory_necessary_for_training</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_training_vectors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.compute_memory_necessary_for_training"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.compute_memory_necessary_for_training" title="Permalink to this definition"></a></dt>
<dd><p>Function that computes the memory necessary to train an index with nb_training_vectors vectors</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.estimated_index_size_in_bytes">
<span class="sig-name descname"><span class="pre">estimated_index_size_in_bytes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.estimated_index_size_in_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.estimated_index_size_in_bytes" title="Permalink to this definition"></a></dt>
<dd><p>Compute the estimated size of the index in bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.get_index_description">
<span class="sig-name descname"><span class="pre">get_index_description</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tunable_parameters_infos</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.get_index_description"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.get_index_description" title="Permalink to this definition"></a></dt>
<dd><p>Gives a generic description of the index.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexMetadata.get_index_type">
<span class="sig-name descname"><span class="pre">get_index_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexMetadata.get_index_type"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexMetadata.get_index_type" title="Permalink to this definition"></a></dt>
<dd><p>return the index type.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#autofaiss.external.metadata.IndexType" title="autofaiss.external.metadata.IndexType"><code class="xref py py-class docutils literal notranslate"><span class="pre">IndexType</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">autofaiss.external.metadata.</span></span><span class="sig-name descname"><span class="pre">IndexType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#IndexType"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.IndexType" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a></p>
<p>An enumeration.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType.FLAT">
<span class="sig-name descname"><span class="pre">FLAT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#autofaiss.external.metadata.IndexType.FLAT" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType.HNSW">
<span class="sig-name descname"><span class="pre">HNSW</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#autofaiss.external.metadata.IndexType.HNSW" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType.IVF_FLAT">
<span class="sig-name descname"><span class="pre">IVF_FLAT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">6</span></em><a class="headerlink" href="#autofaiss.external.metadata.IndexType.IVF_FLAT" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType.NOT_SUPPORTED">
<span class="sig-name descname"><span class="pre">NOT_SUPPORTED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">5</span></em><a class="headerlink" href="#autofaiss.external.metadata.IndexType.NOT_SUPPORTED" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType.OPQ_IVF_HNSW_PQ">
<span class="sig-name descname"><span class="pre">OPQ_IVF_HNSW_PQ</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#autofaiss.external.metadata.IndexType.OPQ_IVF_HNSW_PQ" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType.OPQ_IVF_PQ">
<span class="sig-name descname"><span class="pre">OPQ_IVF_PQ</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#autofaiss.external.metadata.IndexType.OPQ_IVF_PQ" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autofaiss.external.metadata.IndexType.PAD_IVF_HNSW_PQ">
<span class="sig-name descname"><span class="pre">PAD_IVF_HNSW_PQ</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4</span></em><a class="headerlink" href="#autofaiss.external.metadata.IndexType.PAD_IVF_HNSW_PQ" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.metadata.compute_memory_necessary_for_training_wrapper">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.metadata.</span></span><span class="sig-name descname"><span class="pre">compute_memory_necessary_for_training_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_training_vectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_vector</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/metadata.html#compute_memory_necessary_for_training_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.metadata.compute_memory_necessary_for_training_wrapper" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-autofaiss.external.optimize">
<span id="autofaiss-external-optimize-module"></span><h2>autofaiss.external.optimize module<a class="headerlink" href="#module-autofaiss.external.optimize" title="Permalink to this headline"></a></h2>
<p>Functions to find optimal index parameters</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.binary_search_on_param">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">binary_search_on_param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameter_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_speed_ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparameter_str_from_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout_boost_for_precision_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_timeout_per_iteration_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#binary_search_on_param"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.binary_search_on_param" title="Permalink to this definition"></a></dt>
<dd><p>Apply a binary search on a given hyperparameter to maximize the recall given
a query speed constraint in milliseconds/query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>index</strong> (<em>faiss.Index</em>) – Index to search on.</p></li>
<li><p><strong>parameter_range</strong> (<em>List</em><em>[</em><em>T</em><em>]</em>) – List of possible values for the hyperparameter.</p></li>
<li><p><strong>max_speed_ms</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Maximum query speed in milliseconds/query.</p></li>
<li><p><strong>hyperparameter_str_from_param</strong> (<em>Callable</em><em>[</em><em>[</em><em>T</em><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – Function to generate a hyperparameter string from the hyperparameter value
on which we do a binary search.</p></li>
<li><p><strong>timeout_boost_for_precision_search</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Timeout boost for the precision search phase.</p></li>
<li><p><strong>use_gpu</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Whether the index is on the GPU.</p></li>
<li><p><strong>max_timeout_per_iteration_s</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Maximum timeout per iteration in seconds.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.check_if_index_needs_training">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">check_if_index_needs_training</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#check_if_index_needs_training"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.check_if_index_needs_training" title="Permalink to this definition"></a></dt>
<dd><p>Function that checks if the index needs to be trained</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.get_optimal_batch_size">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">get_optimal_batch_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vec_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_memory_available</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#get_optimal_batch_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.get_optimal_batch_size" title="Permalink to this definition"></a></dt>
<dd><p>compute optimal batch size to use the RAM at its full potential for adding vectors</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.get_optimal_hyperparameters">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">get_optimal_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_speed_ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_timeout_per_iteration_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_ef_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#get_optimal_hyperparameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.get_optimal_hyperparameters" title="Permalink to this definition"></a></dt>
<dd><p>Find the optimal hyperparameters to maximize the recall given a query speed in milliseconds/query</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.get_optimal_index_keys_v2">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">get_optimal_index_keys_v2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_index_memory_usage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flat_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantization_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_pq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_direct_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">should_be_memory_mappable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ivf_flat_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#get_optimal_index_keys_v2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.get_optimal_index_keys_v2" title="Permalink to this definition"></a></dt>
<dd><p>Gives a list of interesting indices to try, <em>the one at the top is the most promising</em></p>
<p>See: <a class="reference external" href="https://github.com/facebookresearch/faiss/wiki/Guidelines-to-choose-an-index">https://github.com/facebookresearch/faiss/wiki/Guidelines-to-choose-an-index</a> for
detailed explanations.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.get_optimal_ivf">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">get_optimal_ivf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#get_optimal_ivf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.get_optimal_ivf" title="Permalink to this definition"></a></dt>
<dd><p>Function that returns a list of relevant index_keys to create not quantized IVF indices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>nb_vectors</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Number of vectors in the dataset.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.get_optimal_nb_clusters">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">get_optimal_nb_clusters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#get_optimal_nb_clusters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.get_optimal_nb_clusters" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list with the recommended number of clusters for an index containing nb_vectors vectors.
The first value is the most recommended one.
see: <a class="reference external" href="https://github.com/facebookresearch/faiss/wiki/Guidelines-to-choose-an-index">https://github.com/facebookresearch/faiss/wiki/Guidelines-to-choose-an-index</a></p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.get_optimal_quantization">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">get_optimal_quantization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_quantization_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_max_index_memory_usage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#get_optimal_quantization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.get_optimal_quantization" title="Permalink to this definition"></a></dt>
<dd><p>Function that returns a list of relevant index_keys to create quantized indices.</p>
<dl class="simple">
<dt>nb_vectors: int</dt><dd><p>Number of vectors in the dataset.</p>
</dd>
<dt>dim_vector: int</dt><dd><p>Dimension of the vectors in the dataset.</p>
</dd>
<dt>force_quantization_value: Optional[int]</dt><dd><p>Force to use this value as the size of the quantized vectors (PQx).
It can be used with the force_max_index_memory_usage parameter,
but the result might be empty.</p>
</dd>
<dt>force_max_index_memory_usage: Optional[str]</dt><dd><p>Add a memory constraint on the index.
It can be used with the force_quantization_value parameter,
but the result might be empty.</p>
</dd>
</dl>
<dl class="simple">
<dt>index_keys: List[str]</dt><dd><p>List of index_keys that would be good choices for quantization.
The list can be empty if the given constraints are too strong.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.get_optimal_train_size">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">get_optimal_train_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_vectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_memory_available</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vec_dim</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#get_optimal_train_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.get_optimal_train_size" title="Permalink to this definition"></a></dt>
<dd><p>Function that determines the number of training points necessary to
train the index, based on faiss heuristics for k-means clustering.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.index_key_to_nb_cluster">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">index_key_to_nb_cluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#index_key_to_nb_cluster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.index_key_to_nb_cluster" title="Permalink to this definition"></a></dt>
<dd><p>Function that takes an index key and returns the number of clusters</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.optimize_and_measure_index">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">optimize_and_measure_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_infos_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_index_query_time_ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_on_disk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#optimize_and_measure_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.optimize_and_measure_index" title="Permalink to this definition"></a></dt>
<dd><p>Optimize one index by selecting the best hyperparameters and calculate its metrics</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.optimize.optimize_and_measure_indices">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.optimize.</span></span><span class="sig-name descname"><span class="pre">optimize_and_measure_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices_folder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_infos_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_index_query_time_ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_on_disk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_nb_threads</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/optimize.html#optimize_and_measure_indices"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.optimize.optimize_and_measure_indices" title="Permalink to this definition"></a></dt>
<dd><p>Optimize a list of indices by selecting the best hyperparameters and calculate their metrics</p>
</dd></dl>

</section>
<section id="module-autofaiss.external.quantize">
<span id="autofaiss-external-quantize-module"></span><h2>autofaiss.external.quantize module<a class="headerlink" href="#module-autofaiss.external.quantize" title="Permalink to this headline"></a></h2>
<p>main file to create an index from the the begining</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.quantize.build_index">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.quantize.</span></span><span class="sig-name descname"><span class="pre">build_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embeddings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'knn.index'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_infos_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'index_infos.json'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ids_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_on_disk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'npy'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_column_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'embedding'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id_columns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_param</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_index_query_time_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_index_memory_usage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'16G'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_memory_available</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'32G'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ip'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_direct_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">should_be_memory_mappable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distributed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temporary_indices_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hdfs://root/tmp/distributed_autofaiss_indices'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_indices_to_keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/quantize.html#build_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.quantize.build_index" title="Permalink to this definition"></a></dt>
<dd><p>Reads embeddings and creates a quantized index from them.
The index is stored on the current machine at the given output path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>embeddings</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>np.ndarray</em><em>, </em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>]</em>) – Local path containing all preprocessed vectors and cached files.
This could be a single directory or multiple directories.
Files will be added if empty.
Or directly the Numpy array of embeddings</p></li>
<li><p><strong>index_path</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – Destination path of the quantized model.</p></li>
<li><p><strong>index_infos_path</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – Destination path of the metadata file.</p></li>
<li><p><strong>ids_path</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – Only useful when id_columns is not None and file_format=`parquet`. T
his will be the path (in any filesystem)
where the mapping files Ids-&gt;vector index will be store in parquet format</p></li>
<li><p><strong>save_on_disk</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Whether to save the index on disk, default to True.</p></li>
<li><p><strong>file_format</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – npy or parquet ; default npy</p></li>
<li><p><strong>embedding_column_name</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – embeddings column name for parquet ; default embedding</p></li>
<li><p><strong>id_columns</strong> (<em>Optional</em><em>(</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>)</em>) – Can only be used when file_format=`parquet`.
In this case these are the names of the columns containing the Ids of the vectors,
and separate files will be generated to map these ids to indices in the KNN index ;
default None</p></li>
<li><p><strong>index_key</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – Optional string to give to the index factory in order to create the index.
If None, an index is chosen based on an heuristic.</p></li>
<li><p><strong>index_param</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – Optional string with hyperparameters to set to the index.
If None, the hyper-parameters are chosen based on an heuristic.</p></li>
<li><p><strong>max_index_query_time_ms</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Bound on the query time for KNN search, this bound is approximative</p></li>
<li><p><strong>max_index_memory_usage</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Maximum size allowed for the index, this bound is strict</p></li>
<li><p><strong>current_memory_available</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Memory available on the machine creating the index, having more memory is a boost
because it reduces the swipe between RAM and disk.</p></li>
<li><p><strong>use_gpu</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Experimental, gpu training is faster, not tested so far</p></li>
<li><p><strong>metric_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – <dl class="simple">
<dt>Similarity function used for query:</dt><dd><ul>
<li><p>”ip” for inner product</p></li>
<li><p>”l2” for euclidian distance</p></li>
</ul>
</dd>
</dl>
</p></li>
<li><p><strong>nb_cores</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a><em>]</em>) – Number of cores to use. Will try to guess the right number if not provided</p></li>
<li><p><strong>make_direct_map</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Create a direct map allowing reconstruction of embeddings. This is only needed for IVF indices.
Note that might increase the RAM usage (approximately 8GB for 1 billion embeddings)</p></li>
<li><p><strong>should_be_memory_mappable</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – If set to true, the created index will be selected only among the indices that can be memory-mapped on disk.
This makes it possible to use 50GB indices on a machine with only 1GB of RAM. Default to False</p></li>
<li><p><strong>distributed</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – If “pyspark”, create the indices using pyspark.
Only “parquet” file format is supported.</p></li>
<li><p><strong>temporary_indices_folder</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Folder to save the temporary small indices that are generated by each spark executor.
Only used when distributed = “pyspark”.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – set verbosity of outputs via logging level, default is <cite>logging.INFO</cite></p></li>
<li><p><strong>nb_indices_to_keep</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – <p>Number of indices to keep at most when distributed is “pyspark”.
It allows you to build an index larger than <cite>current_memory_available</cite>
If it is not equal to 1,</p>
<blockquote>
<div><ul>
<li><dl class="simple">
<dt>You are expected to have at most <cite>nb_indices_to_keep</cite> indices with the following names:</dt><dd><p>”{index_path}i” where i ranges from 1 to <cite>nb_indices_to_keep</cite></p>
</dd>
</dl>
</li>
<li><p><cite>build_index</cite> returns a mapping from index path to metrics instead of a tuple (index, metrics)</p></li>
</ul>
</div></blockquote>
<p>Default to 1.</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code></a>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>]]]], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.quantize.main">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.quantize.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/quantize.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.quantize.main" title="Permalink to this definition"></a></dt>
<dd><p>Main entry point</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.quantize.score_index">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.quantize.</span></span><span class="sig-name descname"><span class="pre">score_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embeddings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_on_disk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_index_info_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'infos.json'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_memory_available</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'32G'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/quantize.html#score_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.quantize.score_index" title="Permalink to this definition"></a></dt>
<dd><p>Compute metrics on a given index, use cached ground truth for fast scoring the next times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>index_path</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>Any</em><em>]</em>) – Path to .index file. Or in memory index</p></li>
<li><p><strong>embeddings</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>np.ndarray</em><em>]</em>) – Path containing all preprocessed vectors and cached files. Can also be an in memory array.</p></li>
<li><p><strong>save_on_disk</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Whether to save on disk</p></li>
<li><p><strong>output_index_info_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Path to index infos .json</p></li>
<li><p><strong>current_memory_available</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Memory available on the current machine, having more memory is a boost
because it reduces the swipe between RAM and disk.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – set verbosity of outputs via logging level, default is <cite>logging.INFO</cite></p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.quantize.setup_logging">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.quantize.</span></span><span class="sig-name descname"><span class="pre">setup_logging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logging_level</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/quantize.html#setup_logging"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.quantize.setup_logging" title="Permalink to this definition"></a></dt>
<dd><p>Setup the logging.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.quantize.tune_index">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.quantize.</span></span><span class="sig-name descname"><span class="pre">tune_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_param</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_index_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_on_disk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_index_query_time_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/quantize.html#tune_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.quantize.tune_index" title="Permalink to this definition"></a></dt>
<dd><p>Set hyperparameters to the given index.</p>
<p>If an index_param is given, set this hyperparameters to the index,
otherwise perform a greedy heusistic to make the best out or the max_index_query_time_ms constraint</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>index_path</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>Any</em><em>]</em>) – Path to .index file
Can also be an index</p></li>
<li><p><strong>index_key</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – String to give to the index factory in order to create the index.</p></li>
<li><p><strong>index_param</strong> (<em>Optional</em><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>)</em>) – Optional string with hyperparameters to set to the index.
If None, the hyper-parameters are chosen based on an heuristic.</p></li>
<li><p><strong>output_index_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Path to the newly created .index file</p></li>
<li><p><strong>save_on_disk</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Whether to save the index on disk, default to True.</p></li>
<li><p><strong>max_index_query_time_ms</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Query speed constraint for the index to create.</p></li>
<li><p><strong>use_gpu</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Experimental, gpu training is faster, not tested so far.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – set verbosity of outputs via logging level, default is <cite>logging.INFO</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The faiss index</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>index</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-autofaiss.external.scores">
<span id="autofaiss-external-scores-module"></span><h2>autofaiss.external.scores module<a class="headerlink" href="#module-autofaiss.external.scores" title="Permalink to this headline"></a></h2>
<p>Functions to compute metrics on an index</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.scores.compute_fast_metrics">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.scores.</span></span><span class="sig-name descname"><span class="pre">compute_fast_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">omp_threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/scores.html#compute_fast_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.scores.compute_fast_metrics" title="Permalink to this definition"></a></dt>
<dd><p>compute query speed, size and reconstruction of an index</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.scores.compute_medium_metrics">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.scores.</span></span><span class="sig-name descname"><span class="pre">compute_medium_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memory_available</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ground_truth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_item_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/scores.html#compute_medium_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.scores.compute_medium_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Compute recall&#64;R and intersection recall&#64;R of an index</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.external.scores.get_ground_truth">
<span class="sig-prename descclassname"><span class="pre">autofaiss.external.scores.</span></span><span class="sig-name descname"><span class="pre">get_ground_truth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">faiss_metric_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_embeddings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memory_available</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/external/scores.html#get_ground_truth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.external.scores.get_ground_truth" title="Permalink to this definition"></a></dt>
<dd><p>compute the ground truth (result with a perfect index) of the query on the embeddings</p>
</dd></dl>

</section>
<section id="module-autofaiss.external">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-autofaiss.external" title="Permalink to this headline"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="autofaiss.html" class="btn btn-neutral float-left" title="autofaiss package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="autofaiss.indices.html" class="btn btn-neutral float-right" title="autofaiss.indices package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Criteo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>