<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>autofaiss.indices package &mdash; autofaiss 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="autofaiss.metrics package" href="autofaiss.metrics.html" />
    <link rel="prev" title="autofaiss.external package" href="autofaiss.external.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> autofaiss
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction and installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html#installing-the-requirements">Installing the requirements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started with the CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quantization.html">Creating an index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quantization.html#tuning-an-existing-index">Tuning an existing index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quantization.html#getting-scores-on-an-index">Getting scores on an index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use autofaiss from python</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../API/api.html">Python documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">autofaiss</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="autofaiss.html">autofaiss package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="autofaiss.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="autofaiss.external.html">autofaiss.external package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">autofaiss.indices package</a></li>
<li class="toctree-l4"><a class="reference internal" href="autofaiss.metrics.html">autofaiss.metrics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="autofaiss.utils.html">autofaiss.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="autofaiss.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofaiss.html#module-autofaiss.version">autofaiss.version module</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofaiss.html#module-autofaiss">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started with notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/autofaiss_getting_started.html">Autofaiss getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/autofaiss_index_selection_demo.html">Autofaiss Index selection demo slider</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">autofaiss</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="modules.html">autofaiss</a> &raquo;</li>
          <li><a href="autofaiss.html">autofaiss package</a> &raquo;</li>
      <li>autofaiss.indices package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_source/autofaiss.indices.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="autofaiss-indices-package">
<h1>autofaiss.indices package<a class="headerlink" href="#autofaiss-indices-package" title="Permalink to this headline"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline"></a></h2>
</section>
<section id="module-autofaiss.indices.distributed">
<span id="autofaiss-indices-distributed-module"></span><h2>autofaiss.indices.distributed module<a class="headerlink" href="#module-autofaiss.indices.distributed" title="Permalink to this headline"></a></h2>
<p>Building the index with pyspark.</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.distributed.run">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.distributed.</span></span><span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">faiss_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memory_available_for_adding</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_cores_per_executor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temporary_indices_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hdfs://root/tmp/distributed_autofaiss_indices'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_ids_df_handler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_indices_to_keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/distributed.html#run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.distributed.run" title="Permalink to this definition"></a></dt>
<dd><p>Create indices by pyspark.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>faiss_index</strong> (<em>faiss.Index</em>) – Trained faiss index</p></li>
<li><p><strong>embedding_reader</strong> (<em>EmbeddingReader</em>) – Embedding reader.</p></li>
<li><p><strong>memory_available_for_adding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Memory available for adding embeddings.</p></li>
<li><p><strong>num_cores_per_executor</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Number of CPU cores per executor</p></li>
<li><p><strong>temporary_indices_folder</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Folder to save the temporary small indices</p></li>
<li><p><strong>embedding_ids_df_handler</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>[</em><em>[</em><em>pd.DataFrame</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a><em>]</em><em>, </em><em>Any</em><em>]</em><em>]</em>) – The function that handles the embeddings Ids when id_columns is given</p></li>
<li><p><strong>nb_indices_to_keep</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Number of indices to keep at most after the merging step</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-autofaiss.indices.faiss_index_wrapper">
<span id="autofaiss-indices-faiss-index-wrapper-module"></span><h2>autofaiss.indices.faiss_index_wrapper module<a class="headerlink" href="#module-autofaiss.indices.faiss_index_wrapper" title="Permalink to this headline"></a></h2>
<p>This file contains a wrapper class to create Faiss-like indices</p>
<dl class="py class">
<dt class="sig sig-object py" id="autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">autofaiss.indices.faiss_index_wrapper.</span></span><span class="sig-name descname"><span class="pre">FaissIndexWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/faiss_index_wrapper.html#FaissIndexWrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABC" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></a></p>
<p>This abstract class is describing a Faiss-like index
It is useful to use this wrapper to use benchmarking functions written for
faiss in this library</p>
<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper.add">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/faiss_index_wrapper.html#FaissIndexWrapper.add"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper.add" title="Permalink to this definition"></a></dt>
<dd><p>Function that adds vectors to the index</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<em>2D numpy.array of floats</em>) – Batch of vectors of shape (batch_size, vector_dim)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper.search">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/faiss_index_wrapper.html#FaissIndexWrapper.search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper.search" title="Permalink to this definition"></a></dt>
<dd><p>Function that search the k nearest neighbours of a batch of vectors</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>2D numpy.array of floats</em>) – Batch of vectors of shape (batch_size, vector_dim)</p></li>
<li><p><strong>k</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Number of neighbours to retrieve for every vector</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>D</strong> (<em>2D numpy.array of floats</em>) – Distances numpy array of shape (batch_size, k).
Contains the distances computed by the index of the k nearest neighbours.</p></li>
<li><p><strong>I</strong> (<em>2D numpy.array of ints</em>) – Labels numpy array of shape (batch_size, k).
Contains the vectors’ labels of the k nearest neighbours.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-autofaiss.indices.index_factory">
<span id="autofaiss-indices-index-factory-module"></span><h2>autofaiss.indices.index_factory module<a class="headerlink" href="#module-autofaiss.indices.index_factory" title="Permalink to this headline"></a></h2>
<p>functions that fixe faiss index_factory function</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_factory.index_factory">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_factory.</span></span><span class="sig-name descname"><span class="pre">index_factory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ef_construction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_factory.html#index_factory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_factory.index_factory" title="Permalink to this definition"></a></dt>
<dd><p>custom index_factory that fix some issues of
faiss.index_factory with inner product metrics.</p>
</dd></dl>

</section>
<section id="module-autofaiss.indices.index_utils">
<span id="autofaiss-indices-index-utils-module"></span><h2>autofaiss.indices.index_utils module<a class="headerlink" href="#module-autofaiss.indices.index_utils" title="Permalink to this headline"></a></h2>
<p>useful functions to apply on an index</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.format_speed_ms_per_query">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">format_speed_ms_per_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">speed</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#format_speed_ms_per_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.format_speed_ms_per_query" title="Permalink to this definition"></a></dt>
<dd><p>format the speed (ms/query) into a nice string</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.get_bytes_from_index">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">get_bytes_from_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#get_bytes_from_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.get_bytes_from_index" title="Permalink to this definition"></a></dt>
<dd><p>Transforms a faiss index into a bytearray.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.get_index_from_bytes">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">get_index_from_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_bytes</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#get_index_from_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.get_index_from_bytes" title="Permalink to this definition"></a></dt>
<dd><p>Transforms a bytearray containing a faiss index into the corresponding object.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.get_index_size">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">get_index_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#get_index_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.get_index_size" title="Permalink to this definition"></a></dt>
<dd><p>Returns the size in RAM of a given index</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.parallel_download_indices_from_remote">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">parallel_download_indices_from_remote</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices_file_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst_folder</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#parallel_download_indices_from_remote"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.parallel_download_indices_from_remote" title="Permalink to this definition"></a></dt>
<dd><p>Download small indices in parallel.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.quantize_vec_without_modifying_index">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">quantize_vec_without_modifying_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vecs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#quantize_vec_without_modifying_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.quantize_vec_without_modifying_index" title="Permalink to this definition"></a></dt>
<dd><p>qantize a batch of vectors</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.search_speed_test">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">search_speed_test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksearch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timout_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#search_speed_test"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.search_speed_test" title="Permalink to this definition"></a></dt>
<dd><p>return the average and 99p search speed</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.set_search_hyperparameters">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">set_search_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#set_search_hyperparameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.set_search_hyperparameters" title="Permalink to this definition"></a></dt>
<dd><p>set hyperparameters to an index</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.index_utils.speed_test_ms_per_query">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.index_utils.</span></span><span class="sig-name descname"><span class="pre">speed_test_ms_per_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksearch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timout_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/index_utils.html#speed_test_ms_per_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.index_utils.speed_test_ms_per_query" title="Permalink to this definition"></a></dt>
<dd><p>Evaluate the average speed in milliseconds of the index without using batch</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-autofaiss.indices.memory_efficient_flat_index">
<span id="autofaiss-indices-memory-efficient-flat-index-module"></span><h2>autofaiss.indices.memory_efficient_flat_index module<a class="headerlink" href="#module-autofaiss.indices.memory_efficient_flat_index" title="Permalink to this headline"></a></h2>
<p>This file contain a class describing a memory efficient flat index</p>
<dl class="py class">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">autofaiss.indices.memory_efficient_flat_index.</span></span><span class="sig-name descname"><span class="pre">MemEfficientFlatIndex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper" title="autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">autofaiss.indices.faiss_index_wrapper.FaissIndexWrapper</span></code></a></p>
<p>Faiss-like Flat index that can support any size of vectors
without memory issues.
Two search functions are available to use either batch of smaller faiss
flat index or rely fully on numpy.</p>
<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex.add"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.add" title="Permalink to this definition"></a></dt>
<dd><p>Function that adds vectors to the index</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<em>2D numpy.array of floats</em>) – Batch of vectors of shape (batch_size, vector_dim)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.add_all">
<span class="sig-name descname"><span class="pre">add_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_items</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex.add_all"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.add_all" title="Permalink to this definition"></a></dt>
<dd><p>Function that adds vectors to the index from a memmory-mapped array</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>string</em>) – path of the 2D numpy array of shape (nb_items, vector_dim)
on the disk</p></li>
<li><p><strong>nb_items</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – number of vectors in the 2D array (the dim is already known)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.add_files">
<span class="sig-name descname"><span class="pre">add_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embedding_reader</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex.add_files"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.add_files" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.delete_vectors">
<span class="sig-name descname"><span class="pre">delete_vectors</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex.delete_vectors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.delete_vectors" title="Permalink to this definition"></a></dt>
<dd><p>delete the vectors of the index</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.search">
<span class="sig-name descname"><span class="pre">search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4000000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex.search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.search" title="Permalink to this definition"></a></dt>
<dd><p>Function that search the k nearest neighbours of a batch of vectors</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>2D numpy.array of floats</em>) – Batch of vectors of shape (batch_size, vector_dim)</p></li>
<li><p><strong>k</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Number of neighbours to retrieve for every vector</p></li>
<li><p><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Size of the batch of vectors that are explored.
A bigger value is prefered to avoid multiple loadings
of the vectors from the disk.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>D</strong> (<em>2D numpy.array of floats</em>) – Distances numpy array of shape (batch_size, k).
Contains the distances computed by the index of the k nearest neighbours.</p></li>
<li><p><strong>I</strong> (<em>2D numpy.array of ints</em>) – Labels numpy array of shape (batch_size, k).
Contains the vectors’ labels of the k nearest neighbours.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.search_files">
<span class="sig-name descname"><span class="pre">search_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex.search_files"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.search_files" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.search_numpy">
<span class="sig-name descname"><span class="pre">search_numpy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4000000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/memory_efficient_flat_index.html#MemEfficientFlatIndex.search_numpy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.memory_efficient_flat_index.MemEfficientFlatIndex.search_numpy" title="Permalink to this definition"></a></dt>
<dd><p>Function that search the k nearest neighbours of a batch of vectors.
This implementation is based on vectorized numpy function, it is slower than
the search function based on batches of faiss flat indices.
We keep this implementation because we can build new functions using this code.
Moreover, the distance computation is more precise in numpy than the faiss implementation
that optimizes speed over precision.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xq</strong> (<em>2D numpy.array of floats</em>) – Batch of vectors of shape (batch_size, vector_dim)</p></li>
<li><p><strong>k</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Number of neighbours to retrieve for every vector</p></li>
<li><p><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Size of the batch of vectors that are explored.
A bigger value is prefered to avoid multiple loadings
of the vectors from the disk.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>D</strong> (<em>2D numpy.array of floats</em>) – Distances numpy array of shape (batch_size, k).
Contains the distances computed by the index of the k nearest neighbours.</p></li>
<li><p><strong>I</strong> (<em>2D numpy.array of ints</em>) – Labels numpy array of shape (batch_size, k).
Contains the vectors’ labels of the k nearest neighbours.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-autofaiss.indices.search">
<span id="autofaiss-indices-search-module"></span><h2>autofaiss.indices.search module<a class="headerlink" href="#module-autofaiss.indices.search" title="Permalink to this headline"></a></h2>
<p>function related to search on indices</p>
<dl class="py function">
<dt class="sig sig-object py" id="autofaiss.indices.search.knn_query">
<span class="sig-prename descclassname"><span class="pre">autofaiss.indices.search.</span></span><span class="sig-name descname"><span class="pre">knn_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksearch</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autofaiss/indices/search.html#knn_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autofaiss.indices.search.knn_query" title="Permalink to this definition"></a></dt>
<dd><p>Do a knn search and return a list of the closest items and the associated distance</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>], <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-autofaiss.indices">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-autofaiss.indices" title="Permalink to this headline"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="autofaiss.external.html" class="btn btn-neutral float-left" title="autofaiss.external package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="autofaiss.metrics.html" class="btn btn-neutral float-right" title="autofaiss.metrics package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Criteo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>